<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>YUSUF | PROTOKOL</title>
    <meta name="theme-color" content="#000000" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="description" content="Yusuf Çetinkaya - Kişisel Gelişim ve Görev Protokolü">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.json">
    <link rel="apple-touch-icon" href="https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/72x72/26a1.png">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,400;1,700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['"Plus Jakarta Sans"', 'sans-serif'],
              jakarta: ['"Plus Jakarta Sans"', 'sans-serif'],
              mono: ['"JetBrains Mono"', 'monospace'],
            },
            colors: { black: '#050505' },
            animation: { 'pulse-slow': 'pulse 8s cubic-bezier(0.4, 0, 0.6, 1) infinite' },
            spacing: { 'safe-top': 'env(safe-area-inset-top)', 'safe-bottom': 'env(safe-area-inset-bottom)' }
          }
        }
      }
    </script>

    <!-- React & Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      body { background-color: #000000; overscroll-behavior-y: none; -webkit-tap-highlight-color: transparent; }
      .no-scrollbar::-webkit-scrollbar { display: none; }
      .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
      .custom-scrollbar::-webkit-scrollbar { width: 4px; }
      .custom-scrollbar::-webkit-scrollbar-track { background: #111; }
      .custom-scrollbar::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
      .mask-linear-fade { -webkit-mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent); mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent); }
    </style>

    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
          navigator.serviceWorker.register('./sw.js').then(function(registration) {
            console.log('Neural Core (SW) registered with scope:', registration.scope);
          }, function(err) {
            console.log('Neural Core (SW) failed:', err);
          });
        });
      }
    </script>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.263.1",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
          CheckCircle2, Circle, Clock, Zap, AlertTriangle, Lock, Plus, HelpCircle, 
          Wind, X, ChevronRight, Layers, BellRing, Trash2, Volume2, VolumeX, 
          Repeat, Edit2, RotateCcw, BookOpen, Bell 
        } from 'lucide-react';

        // --- UTILS & CONSTANTS ---
        const generateId = () => Math.random().toString(36).substr(2, 9);

        // Brown Noise Engine
        class NeuralAudio {
          constructor() {
            this.ctx = null; this.node = null; this.gain = null;
            const AudioContextClass = window.AudioContext || window.webkitAudioContext;
            if (AudioContextClass) this.ctx = new AudioContextClass();
          }
          start() {
            if (!this.ctx) return;
            const bufferSize = 4096;
            const whiteNoise = this.ctx.createScriptProcessor(bufferSize, 1, 1);
            let lastOut = 0;
            whiteNoise.onaudioprocess = (e) => {
              const output = e.outputBuffer.getChannelData(0);
              for (let i = 0; i < bufferSize; i++) {
                const white = Math.random() * 2 - 1;
                output[i] = (lastOut + (0.02 * white)) / 1.02; lastOut = output[i]; output[i] *= 3.5;
              }
            };
            this.gain = this.ctx.createGain();
            this.gain.gain.value = 0.15;
            whiteNoise.connect(this.gain);
            this.gain.connect(this.ctx.destination);
            this.node = whiteNoise;
          }
          stop() {
            if (this.node) { this.node.disconnect(); this.node = null; }
            if (this.gain) { this.gain.disconnect(); this.gain = null; }
          }
        }

        const DAYS = ['Pazartesi', 'Salı', 'Çarşamba', 'Perşembe', 'Cuma', 'Cumartesi', 'Pazar'];
        const CATEGORIES = [
          { value: 'INGILIZCE', label: 'İngilizce', color: 'bg-blue-500 border-blue-400 text-blue-100' },
          { value: 'SPOR', label: 'Spor', color: 'bg-indigo-600 border-indigo-400 text-indigo-100' },
          { value: 'MUSTERI', label: 'Müşteri', color: 'bg-amber-600 border-amber-400 text-amber-100' },
          { value: 'OKUMA', label: 'Okuma', color: 'bg-pink-600 border-pink-400 text-pink-100' },
          { value: 'GELISIM', label: 'Gelişim', color: 'bg-fuchsia-600 border-fuchsia-400 text-fuchsia-100' },
          { value: 'SOSYAL', label: 'Sosyallik', color: 'bg-emerald-600 border-emerald-400 text-emerald-100' },
          { value: 'NAMAZ', label: 'Namaz', color: 'bg-teal-700 border-teal-500 text-teal-100' },
          { value: 'DIGER', label: 'Diğer', color: 'bg-gray-700 border-gray-500 text-gray-100' },
        ];

        const DEFAULT_SCHEDULE = [
           { id: 'def-1', title: 'İngilizce Ders', day: 'Pazartesi', startTime: '08:30', endTime: '09:30', category: 'INGILIZCE', status: 'PENDING', impact: 80 },
           { id: 'def-2', title: 'Omuz & Ön Kol & Triceps', day: 'Pazartesi', startTime: '10:00', endTime: '12:00', category: 'SPOR', status: 'PENDING', impact: 90 },
           { id: 'def-3', title: 'Müşteri İşleri', day: 'Pazartesi', startTime: '12:00', endTime: '17:00', category: 'MUSTERI', status: 'PENDING', impact: 100 },
           { id: 'def-4', title: 'Okuma / Film', day: 'Pazartesi', startTime: '17:30', endTime: '19:00', category: 'OKUMA', status: 'PENDING', impact: 60 },
           { id: 'def-5', title: 'Kendini Geliştir', day: 'Pazartesi', startTime: '19:30', endTime: '23:30', category: 'GELISIM', status: 'PENDING', impact: 70 },
           
           { id: 'def-6', title: 'İngilizce Ders', day: 'Salı', startTime: '08:30', endTime: '09:30', category: 'INGILIZCE', status: 'PENDING', impact: 80 },
           { id: 'def-7', title: 'Bacak Günü (Es Geçme)', day: 'Salı', startTime: '10:00', endTime: '12:00', category: 'SPOR', status: 'PENDING', impact: 95 },
           { id: 'def-8', title: 'Müşteri İşleri', day: 'Salı', startTime: '12:00', endTime: '17:00', category: 'MUSTERI', status: 'PENDING', impact: 100 },
           { id: 'def-9', title: 'Okuma / Dizi', day: 'Salı', startTime: '17:30', endTime: '19:00', category: 'OKUMA', status: 'PENDING', impact: 60 },
           { id: 'def-10', title: 'Serbest Zaman', day: 'Salı', startTime: '19:30', endTime: '00:00', category: 'SOSYAL', status: 'PENDING', impact: 50 },

           { id: 'def-11', title: 'İngilizce Ders', day: 'Çarşamba', startTime: '09:30', endTime: '11:00', category: 'INGILIZCE', status: 'PENDING', impact: 80 },
           { id: 'def-12', title: 'Müşteri İşleri', day: 'Çarşamba', startTime: '11:30', endTime: '16:00', category: 'MUSTERI', status: 'PENDING', impact: 100 },
           { id: 'def-13', title: 'Okuma (Kaçış Yok)', day: 'Çarşamba', startTime: '16:30', endTime: '19:00', category: 'OKUMA', status: 'PENDING', impact: 70 },
           { id: 'def-14', title: 'Evde Gelişim', day: 'Çarşamba', startTime: '19:00', endTime: '00:00', category: 'GELISIM', status: 'PENDING', impact: 85 },

           { id: 'def-15', title: 'İngilizce Ders', day: 'Perşembe', startTime: '08:30', endTime: '09:30', category: 'INGILIZCE', status: 'PENDING', impact: 80 },
           { id: 'def-16', title: 'Sırt & Ön Kol', day: 'Perşembe', startTime: '10:00', endTime: '12:00', category: 'SPOR', status: 'PENDING', impact: 90 },
           { id: 'def-17', title: 'Müşteri İşleri', day: 'Perşembe', startTime: '12:00', endTime: '17:00', category: 'MUSTERI', status: 'PENDING', impact: 100 },
           { id: 'def-18', title: 'Okuma / İrade', day: 'Perşembe', startTime: '17:30', endTime: '19:00', category: 'OKUMA', status: 'PENDING', impact: 60 },
           { id: 'def-19', title: 'Gelişim / Hava Al', day: 'Perşembe', startTime: '19:00', endTime: '00:00', category: 'GELISIM', status: 'PENDING', impact: 70 },

           { id: 'def-20', title: 'İngilizce Ders', day: 'Cuma', startTime: '09:00', endTime: '10:30', category: 'INGILIZCE', status: 'PENDING', impact: 80 },
           { id: 'def-21', title: 'Gelişim', day: 'Cuma', startTime: '10:30', endTime: '12:00', category: 'GELISIM', status: 'PENDING', impact: 75 },
           { id: 'def-22', title: 'Cuma Namazı', day: 'Cuma', startTime: '13:00', endTime: '14:30', category: 'NAMAZ', status: 'PENDING', impact: 100 },
           { id: 'def-23', title: 'Müşteri İşleri', day: 'Cuma', startTime: '14:30', endTime: '19:00', category: 'MUSTERI', status: 'PENDING', impact: 100 },
           { id: 'def-24', title: 'Kafana Göre', day: 'Cuma', startTime: '19:00', endTime: '00:00', category: 'SOSYAL', status: 'PENDING', impact: 50 },

           { id: 'def-25', title: 'Göğüs & Triceps', day: 'Cumartesi', startTime: '11:00', endTime: '12:30', category: 'SPOR', status: 'PENDING', impact: 90 },
           { id: 'def-26', title: 'Planlama', day: 'Cumartesi', startTime: '13:30', endTime: '14:30', category: 'GELISIM', status: 'PENDING', impact: 80 },
           { id: 'def-27', title: 'Aile / Serbest', day: 'Cumartesi', startTime: '15:00', endTime: '20:00', category: 'SOSYAL', status: 'PENDING', impact: 60 },

           { id: 'def-28', title: 'Deşarj', day: 'Pazar', startTime: '10:00', endTime: '22:00', category: 'SOSYAL', status: 'PENDING', impact: 100 }
        ];

        const GUIDE_STEPS = [
          { title: "1. HAFIZA KALICILIĞI", description: "Verilerin artık cihaz hafızasına kazındı. Sayfayı yenilesen de kaçış yok.", icon: 'Matrix' },
          { title: "2. DİSİPLİN UYARILARI", description: "Sistemin seni darlaması için 'DİSİPLİN MODUNU AÇ' butonuna basmalısın. İrade gerektirir.", icon: 'Zap' },
          { title: "3. GÖREV ZAMANLAMASI", description: "Tamamla, Geri Al, Düzenle. Yanlışlıkla basarsan geri alabilirsin.", icon: 'Focus' }
        ];

        const MANUAL_CONTENT = `SİSTEM KULLANIM KILAVUZU v5.0 (Persistence Update)\n\n1. SÜREKLİLİK (PERSISTENCE)\nEski sistemdeki 'yenileyince silinme' hatası giderildi. LocalStorage protokolü ile verilerin telefonunun hafıza çipine yazılıyor.\n\n2. BİLDİRİM MEKANİZMASI\nModern tarayıcılar (iOS/Chrome) otomatik bildirimleri engeller. Bu yüzden ekranın altındaki KIRMIZI butona basarak sisteme 'Beni Rahatsız Etme Hakkı' vermelisin.\n\n3. NÖRAL DARLAMA (NAGGING)\n- Namaz vakitleri girince.\n- Görev saati gelince.\n- Ve her 45 dakikada bir 'Rastgele Disiplin Kontrolü' bildirimi alacaksın.`;

        const getSystemMessage = (type) => {
          const messages = {
            SUCCESS: ["İrade çeliği dövüldü.", "Nöral bağlantı güçlendi.", "Disiplin artıyor.", "Mükemmellik alışkanlıktır."],
            SNOOZE: ["Zaman beklemez.", "Erteleme, başarının kanseridir."],
            CRITICAL: ["Şimdi değilse ne zaman?", "Harekete geç.", "Matris seni bekliyor."],
            NEUTRAL: ["Sistem hafızası aktif.", "Protokol devrede.", "Veriler koruma altında."]
          };
          return messages[type][Math.floor(Math.random() * messages[type].length)];
        };

        const calculatePrayerTimes = () => {
          const date = new Date();
          const dayOfYear = Math.floor((date.getTime() - new Date(date.getFullYear(), 0, 0).getTime()) / 1000 / 60 / 60 / 24);
          const h = date.getHours();
          const m = date.getMinutes();
          const currentTime = h * 60 + m;
          const seasonalOffset = Math.sin((dayOfYear - 80) * 2 * Math.PI / 365); 
          let imsakBase = 5 * 60; let ogleBase = 13 * 60 + 10; let ikindiBase = 16 * 60 + 30; let aksamBase = 19 * 60 + 30; let yatsiBase = 21 * 60;
          const imsak = imsakBase - (seasonalOffset * 90);
          const ogle = ogleBase + (seasonalOffset * 5);
          const ikindi = ikindiBase + (seasonalOffset * 40);
          const aksam = aksamBase + (seasonalOffset * 80);
          const yatsi = yatsiBase + (seasonalOffset * 80);
          const formatMin = (totalMin) => {
            const hh = Math.floor(totalMin / 60);
            const mm = Math.floor(totalMin % 60);
            return `${hh.toString().padStart(2, '0')}:${mm.toString().padStart(2, '0')}`;
          };
          return [
            { name: 'İMSAK', time: formatMin(imsak), raw: imsak, isActive: currentTime >= imsak && currentTime < ogle },
            { name: 'ÖĞLE', time: formatMin(ogle), raw: ogle, isActive: currentTime >= ogle && currentTime < ikindi },
            { name: 'İKİNDİ', time: formatMin(ikindi), raw: ikindi, isActive: currentTime >= ikindi && currentTime < aksam },
            { name: 'AKŞAM', time: formatMin(aksam), raw: aksam, isActive: currentTime >= aksam && currentTime < yatsi },
            { name: 'YATSI', time: formatMin(yatsi), raw: yatsi, isActive: currentTime >= yatsi || currentTime < imsak },
          ];
        };

        // --- COMPONENTS ---
        const NeuralGuide = ({ isOpen, onClose }) => {
          const [step, setStep] = useState(0);
          const [showFullManual, setShowFullManual] = useState(false);
          if (!isOpen) return null;
          if (showFullManual) return (
             <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/95 backdrop-blur-xl animate-in fade-in">
                 <div className="w-full max-w-2xl h-[80vh] bg-black/50 border border-emerald-500/30 rounded-3xl p-6 relative flex flex-col">
                    <div className="flex justify-between items-center mb-4 border-b border-white/10 pb-4">
                      <h3 className="text-xl font-bold text-emerald-400 tracking-widest font-mono">SİSTEM KILAVUZU</h3>
                      <button onClick={() => setShowFullManual(false)}><X className="text-white" /></button>
                    </div>
                    <div className="overflow-y-auto pr-2 custom-scrollbar text-gray-300 font-mono text-sm leading-relaxed whitespace-pre-wrap">{MANUAL_CONTENT}</div>
                 </div>
              </div>
          );
          const currentStep = GUIDE_STEPS[step];
          const handleNext = () => { if (step < GUIDE_STEPS.length - 1) setStep(s => s + 1); else onClose(); };
          return (
            <div className="fixed inset-0 z-[100] flex items-center justify-center p-6 bg-black/90 backdrop-blur-xl animate-in fade-in duration-300">
              <div className="w-full max-w-md bg-black/40 border border-emerald-500/30 rounded-3xl p-8 relative overflow-hidden shadow-[0_0_50px_rgba(16,185,129,0.1)]">
                <div className="min-h-[200px] flex flex-col items-center text-center space-y-6">
                   <div className="w-20 h-20 rounded-full bg-emerald-900/20 border border-emerald-500/20 flex items-center justify-center"><Zap className="w-10 h-10 text-emerald-400" /></div>
                   <div><h3 className="text-2xl font-bold text-white mb-3 font-jakarta tracking-tight">{currentStep.title}</h3><p className="text-gray-400 text-sm leading-relaxed">{currentStep.description}</p></div>
                </div>
                <div className="space-y-3 mt-8">
                  <button onClick={handleNext} className="w-full bg-emerald-600 hover:bg-emerald-500 text-black font-bold py-4 rounded-xl flex items-center justify-center space-x-2 transition-all"><span>{step === GUIDE_STEPS.length - 1 ? "ANLAŞILDI" : "DEVAM ET"}</span><ChevronRight className="w-4 h-4" /></button>
                  <button onClick={() => setShowFullManual(true)} className="w-full py-3 text-xs text-gray-500 hover:text-white underline decoration-dotted underline-offset-4">KILAVUZU OKU</button>
                </div>
              </div>
            </div>
          );
        };

        const TaskEditor = ({ isOpen, onClose, onSave, initialTask }) => {
          const [title, setTitle] = useState("");
          const [day, setDay] = useState('Pazartesi');
          const [category, setCategory] = useState('DIGER');
          const [startTime, setStartTime] = useState("");
          const [endTime, setEndTime] = useState("");
          useEffect(() => {
            if (isOpen) {
              if (initialTask) { setTitle(initialTask.title); setDay(initialTask.day); setCategory(initialTask.category); setStartTime(initialTask.startTime); setEndTime(initialTask.endTime); }
              else { setTitle(""); setDay('Pazartesi'); setCategory('DIGER'); setStartTime(""); setEndTime(""); }
            }
          }, [isOpen, initialTask]);
          if (!isOpen) return null;
          const handleSubmit = (e) => { e.preventDefault(); if (!title || !startTime || !endTime) return; onSave({ title, day, category, startTime, endTime, id: initialTask?.id }); onClose(); };
          return (
            <div className="fixed inset-0 z-[90] flex items-end sm:items-center justify-center bg-black/80 backdrop-blur-sm p-4">
              <div className="w-full max-w-lg bg-[#0a0a0a] border border-white/10 rounded-2xl p-6 shadow-2xl animate-in slide-in-from-bottom duration-300">
                <div className="flex justify-between items-center mb-6"><h3 className="text-lg font-bold text-white tracking-widest">{initialTask ? 'GÖREVİ DÜZENLE' : 'YENİ GÖREV'}</h3><button onClick={onClose}><X className="text-gray-500 hover:text-white" /></button></div>
                <form onSubmit={handleSubmit} className="space-y-4">
                  <div><label className="text-xs text-gray-500 uppercase">Başlık</label><input type="text" value={title} onChange={e => setTitle(e.target.value)} className="w-full bg-white/5 border border-white/10 rounded-lg p-3 text-white outline-none focus:border-emerald-500" /></div>
                  <div className="grid grid-cols-2 gap-4">
                    <div><label className="text-xs text-gray-500 uppercase">Gün</label><select value={day} onChange={e => setDay(e.target.value)} className="w-full bg-white/5 border border-white/10 rounded-lg p-3 text-white outline-none bg-black">{DAYS.map(d => <option key={d} value={d}>{d}</option>)}</select></div>
                    <div><label className="text-xs text-gray-500 uppercase">Kategori</label><select value={category} onChange={e => setCategory(e.target.value)} className="w-full bg-white/5 border border-white/10 rounded-lg p-3 text-white outline-none bg-black">{CATEGORIES.map(c => <option key={c.value} value={c.value}>{c.label}</option>)}</select></div>
                  </div>
                  <div className="grid grid-cols-2 gap-4">
                     <div><label className="text-xs text-gray-500 uppercase">Başlangıç</label><input type="time" value={startTime} onChange={e => setStartTime(e.target.value)} className="w-full bg-white/5 border border-white/10 rounded-lg p-3 text-white outline-none" /></div>
                     <div><label className="text-xs text-gray-500 uppercase">Bitiş</label><input type="time" value={endTime} onChange={e => setEndTime(e.target.value)} className="w-full bg-white/5 border border-white/10 rounded-lg p-3 text-white outline-none" /></div>
                  </div>
                  <button type="submit" className="w-full bg-emerald-600 hover:bg-emerald-500 text-black font-bold py-4 rounded-xl mt-4">{initialTask ? 'KAYDET' : 'EKLE'}</button>
                </form>
              </div>
            </div>
          );
        };

        const App = () => {
          // --- BLACK BOX PERSISTENCE (LOCALSTORAGE) ---
          const [tasks, setTasks] = useState(() => { 
            try { 
              const stored = localStorage.getItem('elysian_core_v5_tasks'); 
              return stored ? JSON.parse(stored) : DEFAULT_SCHEDULE; 
            } catch { return DEFAULT_SCHEDULE; } 
          });
          const [protocols, setProtocols] = useState(() => {
             try {
                const stored = localStorage.getItem('elysian_core_v5_protocols');
                return stored ? JSON.parse(stored) : [{ id: 'p1', title: 'Derin Okuma (20dk)', completed: false }, { id: 'p2', title: 'Su Tüketimi (2.5L)', completed: false }, { id: 'p3', title: 'Antrenman', completed: false }];
             } catch { return []; }
          });
          const [neuralState, setNeuralState] = useState(() => {
             try {
               const stored = localStorage.getItem('elysian_core_v5_state');
               return stored ? JSON.parse(stored) : { zapScore: 0, hasSeenOnboarding: false, lastActive: new Date().toISOString() };
             } catch { return { zapScore: 0, hasSeenOnboarding: false }; }
          });
          const [permission, setPermission] = useState(Notification.permission);
          
          // Component State
          const [prayerTimes, setPrayerTimes] = useState([]);
          const [systemMessage, setSystemMessage] = useState("Sistem başlatılıyor...");
          const [isMessageVisible, setIsMessageVisible] = useState(false);
          const [showGuide, setShowGuide] = useState(false);
          const [isEditorOpen, setIsEditorOpen] = useState(false);
          const [editingTask, setEditingTask] = useState(null);

          // --- SAVING LOGIC (The "Save" Button is automatic now) ---
          useEffect(() => { localStorage.setItem('elysian_core_v5_tasks', JSON.stringify(tasks)); }, [tasks]);
          useEffect(() => { localStorage.setItem('elysian_core_v5_protocols', JSON.stringify(protocols)); }, [protocols]);
          useEffect(() => { localStorage.setItem('elysian_core_v5_state', JSON.stringify(neuralState)); }, [neuralState]);

          // --- NEURAL NAGGING & NOTIFICATIONS ---
          const sendNotification = (title, body) => {
            if (Notification.permission === 'granted') {
              try {
                new Notification(title, { body, icon: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/72x72/26a1.png', vibrate: [200, 100, 200] });
              } catch(e) { console.log('Notif error', e); }
            }
          };

          const requestPermission = async () => {
            const result = await Notification.requestPermission();
            setPermission(result);
            if (result === 'granted') {
              triggerSystemMessage("BİLDİRİM AĞI AKTİF.");
              sendNotification("DİSİPLİN AKTİF", "Sistem seni izlemeye başladı.");
            }
          };

          useEffect(() => {
             const checkInterval = setInterval(() => {
                const now = new Date();
                const h = now.getHours();
                const m = now.getMinutes();
                const currentMin = h * 60 + m;
                
                // 1. Prayer Checks
                const pts = calculatePrayerTimes();
                setPrayerTimes(pts);
                pts.forEach(p => {
                  const pMin = Math.floor(p.raw);
                  if (currentMin === pMin) {
                     sendNotification("NAMAZ VAKTİ", `${p.name} girdi. Matris'ten kop, secdeye bağlan.`);
                  }
                });

                // 2. Task Checks
                const todayName = DAYS[now.getDay() === 0 ? 6 : now.getDay() - 1];
                tasks.forEach(t => {
                   if (t.day === todayName && t.status !== 'COMPLETED') {
                      const [th, tm] = t.startTime.split(':').map(Number);
                      if (th === h && tm === m) {
                         sendNotification("GÖREV ZAMANI", `${t.title} - Şimdi başla. Erteleme.`);
                      }
                   }
                });
             }, 30000); // Check every 30s

             // 3. Random Nagging (Every 45 mins)
             const nagInterval = setInterval(() => {
                if (Math.random() > 0.3) {
                   sendNotification("DİSİPLİN KONTROLÜ", "45 dakika geçti. Hala odakta mısın yoksa kaytarıyor musun?");
                }
             }, 45 * 60 * 1000);

             return () => { clearInterval(checkInterval); clearInterval(nagInterval); };
          }, [tasks]);

          useEffect(() => { if (!neuralState.hasSeenOnboarding) setTimeout(() => setShowGuide(true), 500); }, []);

          const triggerSystemMessage = (msg) => { setSystemMessage(msg); setIsMessageVisible(true); setTimeout(() => setIsMessageVisible(false), 4000); };

          const handleTaskAction = (action, id) => {
            if (action === 'DELETE') { setTasks(prev => prev.filter(t => t.id !== id)); triggerSystemMessage("Görev silindi."); return; }
            setTasks(prev => prev.map(t => {
              if (t.id === id) {
                if (action === 'COMPLETE') {
                  setNeuralState(s => ({ ...s, zapScore: s.zapScore + t.impact })); triggerSystemMessage(getSystemMessage('SUCCESS')); return { ...t, status: 'COMPLETED' };
                } else if (action === 'UNDO') {
                  setNeuralState(s => ({ ...s, zapScore: Math.max(0, s.zapScore - t.impact) })); triggerSystemMessage("Geri alındı."); return { ...t, status: 'PENDING' };
                }
              }
              return t;
            }));
          };
          
          const handleSaveTask = (taskData) => {
            if (taskData.id) { setTasks(prev => prev.map(t => t.id === taskData.id ? { ...t, ...taskData } : t)); triggerSystemMessage("Görev güncellendi."); }
            else { const newTask = { id: generateId(), ...taskData, status: 'PENDING', impact: 70 }; setTasks(prev => [...prev, newTask]); triggerSystemMessage("Görev eklendi."); }
          };

          return (
            <div className="min-h-screen bg-black text-gray-200 font-sans pb-48 overflow-x-hidden">
              <div className="fixed inset-0 pointer-events-none z-0">
                <div className="absolute top-[-10%] right-[-10%] w-[500px] h-[500px] bg-emerald-900/10 rounded-full blur-[120px] animate-pulse-slow" />
              </div>

              <NeuralGuide isOpen={showGuide} onClose={() => { setShowGuide(false); setNeuralState(s => ({...s, hasSeenOnboarding: true})); }} />
              <TaskEditor isOpen={isEditorOpen} onClose={() => setIsEditorOpen(false)} onSave={handleSaveTask} initialTask={editingTask} />

              <header className="sticky top-0 z-50 pt-safe-top bg-black/80 backdrop-blur-xl border-b border-white/5">
                <div className="px-6 py-4 flex justify-between items-center">
                  <div className="flex items-center space-x-3"><div className="w-8 h-8 rounded-lg bg-emerald-500/10 border border-emerald-500/50 flex items-center justify-center"><div className="w-3 h-3 bg-emerald-400 rounded-sm rotate-45"></div></div><h1 className="text-xl font-extrabold italic tracking-tighter text-white font-jakarta">YUSUF | V5</h1></div>
                  <div className="flex items-center space-x-3">
                     <div className="flex items-center space-x-1.5 mr-2"><Zap className="w-3.5 h-3.5 text-yellow-400" /><span className="text-lg font-bold text-white tabular-nums">{neuralState.zapScore}</span></div>
                     <button onClick={() => { if(confirm('Tüm veriler silinsin mi?')) { localStorage.clear(); window.location.reload(); } }} className="w-9 h-9 rounded-full bg-white/5 flex items-center justify-center text-white/50 hover:text-rose-400"><Trash2 className="w-4 h-4" /></button>
                  </div>
                </div>
              </header>

              <main className="relative z-10 max-w-2xl mx-auto">
                <div className="px-6 py-6 overflow-x-auto no-scrollbar mask-linear-fade">
                  <div className="flex space-x-3 min-w-max">
                    {prayerTimes.map((p, i) => (
                      <div key={i} className={`flex flex-col pl-4 pr-8 py-3 rounded-xl border transition-all ${p.isActive ? 'bg-emerald-950/30 border-emerald-500/50 scale-105' : 'bg-white/[0.02] border-white/5 grayscale opacity-60'}`}>
                        <span className={`text-[9px] font-black tracking-[0.2em] mb-1 ${p.isActive ? 'text-emerald-400' : 'text-gray-600'}`}>{p.name}</span>
                        <span className="text-xl font-mono tracking-tighter text-white">{p.time}</span>
                      </div>
                    ))}
                  </div>
                </div>

                <div className={`fixed top-[140px] left-0 right-0 z-40 pointer-events-none flex justify-center transition-all duration-500 ${isMessageVisible ? 'opacity-100 translate-y-0' : 'opacity-0 -translate-y-4'}`}>
                  <div className="bg-black/90 border border-emerald-500/30 px-5 py-2.5 rounded-full shadow-lg flex items-center space-x-2"><div className="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse" /><p className="text-emerald-50 text-[10px] font-mono tracking-widest uppercase">{systemMessage}</p></div>
                </div>

                <div className="px-6 mb-6">
                  {protocols.map(p => (
                    <button key={p.id} onClick={() => setProtocols(prev => prev.map(proto => proto.id === p.id ? { ...proto, completed: !proto.completed } : proto))} className={`w-full flex items-center justify-between p-3 rounded-lg border mb-2 transition-all ${p.completed ? 'bg-emerald-900/10 border-emerald-500/30' : 'bg-white/5 border-white/5'}`}>
                       <div className="flex items-center space-x-3"><div className={`w-4 h-4 rounded border flex items-center justify-center ${p.completed ? 'bg-emerald-500 border-emerald-500' : 'border-white/20'}`}>{p.completed && <CheckCircle2 className="w-3 h-3 text-black" />}</div><span className={`text-xs font-bold ${p.completed ? 'text-emerald-400' : 'text-gray-400'}`}>{p.title}</span></div>
                    </button>
                  ))}
                </div>

                <div className="px-4 space-y-6">
                  {DAYS.map(day => {
                    const dayTasks = tasks.filter(t => t.day === day).sort((a, b) => a.startTime.localeCompare(b.startTime));
                    if (dayTasks.length === 0) return null;
                    return (
                      <div key={day} className="animate-in slide-in-from-bottom duration-500">
                        <div className="flex items-center space-x-4 mb-3 px-2"><div className="h-[1px] flex-1 bg-white/10" /><h2 className="text-sm font-black tracking-[0.2em] text-emerald-500 uppercase">{day}</h2><div className="h-[1px] flex-1 bg-white/10" /></div>
                        <div>{dayTasks.map(task => {
                           const isCompleted = task.status === 'COMPLETED';
                           const cat = CATEGORIES.find(c => c.value === task.category) || CATEGORIES[7];
                           return (
                             <div key={task.id} className={`relative overflow-hidden rounded-xl border mb-3 transition-all ${isCompleted ? 'bg-gray-900/50 border-white/5 opacity-50' : 'bg-white/[0.03] border-white/10'}`}>
                               <div className={`absolute left-0 top-0 bottom-0 w-1 ${isCompleted ? 'bg-gray-600' : cat.color.split(' ')[0]}`} />
                               <div className="p-4 pl-5">
                                 <h4 className={`font-jakarta font-medium text-sm mb-1 ${isCompleted ? 'line-through text-gray-500' : 'text-white'}`}>{task.title}</h4>
                                 <div className="flex items-center space-x-3 text-xs font-mono text-gray-500"><span>{task.startTime}-{task.endTime}</span><span className={`px-1 rounded ${cat.color}`}>{cat.label}</span></div>
                                 <div className="flex items-center space-x-2 mt-4">
                                   <button onClick={() => handleTaskAction(isCompleted ? 'UNDO' : 'COMPLETE', task.id)} className={`flex-1 text-xs font-bold py-2 rounded flex items-center justify-center space-x-1 ${isCompleted ? 'bg-gray-800' : 'bg-emerald-600 text-black'}`}>{isCompleted ? 'GERİ AL' : 'TAMAMLA'}</button>
                                   <button onClick={() => { setEditingTask(task); setIsEditorOpen(true); }} className="px-3 py-2 bg-blue-600/20 text-blue-400 rounded"><Edit2 className="w-3.5 h-3.5" /></button>
                                   <button onClick={() => handleTaskAction('DELETE', task.id)} className="px-3 py-2 bg-red-600/20 text-red-400 rounded"><Trash2 className="w-3.5 h-3.5" /></button>
                                 </div>
                               </div>
                             </div>
                           );
                        })}</div>
                      </div>
                    );
                  })}
                </div>
              </main>

              {/* DİSİPLİN BUTONU (Notification Trigger) */}
              {permission !== 'granted' && (
                <div className="fixed bottom-24 left-0 right-0 z-50 px-6 flex justify-center animate-bounce">
                  <button onClick={requestPermission} className="bg-red-600 hover:bg-red-500 text-white font-black text-xs py-3 px-6 rounded-full shadow-[0_0_20px_rgba(220,38,38,0.5)] flex items-center space-x-2 tracking-widest uppercase border-2 border-red-400">
                    <BellRing className="w-4 h-4" /> <span>DİSİPLİN MODUNU AÇ</span>
                  </button>
                </div>
              )}

              <div className="fixed bottom-0 left-0 right-0 z-50 bg-gradient-to-t from-black via-black/95 to-transparent pt-10 pb-6 px-6">
                <button onClick={() => { setEditingTask(null); setIsEditorOpen(true); }} className="w-full h-14 bg-emerald-600 rounded-2xl flex items-center justify-center text-black font-bold text-sm tracking-widest hover:bg-emerald-500 transition-colors shadow-[0_0_20px_rgba(16,185,129,0.3)] active:scale-98"><Plus className="w-5 h-5 mr-2" /> YENİ GÖREV EKLE</button>
              </div>
            </div>
          );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
