<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>YUSUF | PROTOKOL V5</title>
    <meta name="theme-color" content="#000000" />
    
    <!-- PWA -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <link rel="manifest" href="./manifest.json">
    <link rel="apple-touch-icon" href="https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/72x72/26a1.png">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <!-- CSS Framework -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'], mono: ['"JetBrains Mono"', 'monospace'] },
            colors: { black: '#000000', dark: '#050505', emerald: { 450: '#10b981' } },
            animation: { 'pulse-slow': 'pulse 8s cubic-bezier(0.4, 0, 0.6, 1) infinite' },
            spacing: { 'safe-top': 'env(safe-area-inset-top)', 'safe-bottom': 'env(safe-area-inset-bottom)' },
            backgroundImage: { 'neural-gradient': 'radial-gradient(circle at 50% 0%, rgba(16, 185, 129, 0.15), transparent 70%)' }
          }
        }
      }
    </script>
    
    <!-- React Core (UMD - Stable) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      body { background-color: #000000; color: #e5e7eb; overscroll-behavior-y: none; -webkit-tap-highlight-color: transparent; }
      .no-scrollbar::-webkit-scrollbar { display: none; } .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
      .glass-panel { background: rgba(20, 20, 20, 0.6); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.08); }
      #loader { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.5s; }
      .spinner { width: 50px; height: 50px; border: 3px solid rgba(16, 185, 129, 0.2); border-radius: 50%; border-top-color: #10b981; animation: spin 1s ease-in-out infinite; }
      @keyframes spin { to { transform: rotate(360deg); } }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "lucide-react": "https://esm.sh/lucide-react@^0.562.0",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body>
    <div id="loader">
        <div class="spinner"></div>
        <div class="mt-6 text-emerald-500 font-mono text-[10px] tracking-[0.4em] animate-pulse">SİSTEM BAŞLATILIYOR</div>
    </div>
    <div id="root"></div>

    <!-- Hata Yakalama Sistemi -->
    <script>
      window.onerror = function(msg, url, line) {
        document.getElementById('loader').style.display='none';
        document.body.innerHTML = `<div style="background:black;color:#ef4444;padding:24px;font-family:monospace;height:100vh;">
          <h2 style="border-bottom:1px solid #333;padding-bottom:12px;">SİSTEM HATASI</h2>
          <p style="margin-top:16px;font-size:12px;opacity:0.8;">${msg}</p>
          <button onclick="localStorage.clear();location.reload()" style="margin-top:24px;background:#ef4444;color:white;border:none;padding:12px 24px;border-radius:8px;font-weight:bold;">SİSTEMİ SIFIRLA</button>
        </div>`;
      };
    </script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { createRoot } = ReactDOM;

        // --- ICONS (Manuel SVG Tanımları - Hata Riskini Sıfırlar) ---
        const Icon = ({ path, className = "w-5 h-5", ...props }) => (
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{path}</svg>
        );
        const Zap = (p) => <Icon path={<polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />} {...p} />;
        const Trash2 = (p) => <Icon path={<><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></>} {...p} />;
        const Edit2 = (p) => <Icon path={<path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/>} {...p} />;
        const Plus = (p) => <Icon path={<><path d="M5 12h14"/><path d="M12 5v14"/></>} {...p} />;
        const X = (p) => <Icon path={<><path d="M18 6 6 18"/><path d="m6 6 18 18"/></>} {...p} />;
        const BellRing = (p) => <Icon path={<><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></>} {...p} />;
        const CheckCircle2 = (p) => <Icon path={<><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></>} {...p} />;
        const ChevronRight = (p) => <Icon path={<path d="m9 18 6-6-6-6"/>} {...p} />;

        // --- VERİ VE MANTIK ---
        const generateId = () => Math.random().toString(36).substr(2, 9);
        const CATEGORIES = {
          'INGILIZCE': { label: 'İngilizce', color: 'bg-blue-600' }, 'SPOR': { label: 'Spor', color: 'bg-indigo-600' },
          'MUSTERI': { label: 'Müşteri', color: 'bg-amber-600' }, 'OKUMA': { label: 'Okuma', color: 'bg-pink-600' },
          'GELISIM': { label: 'Gelişim', color: 'bg-fuchsia-600' }, 'SOSYAL': { label: 'Sosyal', color: 'bg-emerald-600' },
          'NAMAZ': { label: 'Namaz', color: 'bg-teal-700' }, 'DIGER': { label: 'Diğer', color: 'bg-zinc-600' }
        };

        const App = () => {
          // BAŞLANGIÇ DURUMU (GÜVENLİ YÜKLEME)
          const [tasks, setTasks] = useState(() => {
            try { return JSON.parse(localStorage.getItem('elysian_tasks')) || []; } catch { return []; }
          });
          const [protocols, setProtocols] = useState(() => {
            try { return JSON.parse(localStorage.getItem('elysian_protocols')) || [{id:'p1', title:'Derin Okuma', completed:false}, {id:'p2', title:'Su (2.5L)', completed:false}, {id:'p3', title:'Antrenman', completed:false}]; } catch { return []; }
          });
          const [state, setState] = useState(() => {
            try { return JSON.parse(localStorage.getItem('elysian_state')) || { zapScore: 0, hasSeenOnboarding: false }; } catch { return { zapScore: 0, hasSeenOnboarding: false }; }
          });

          const [prayerTimes, setPrayerTimes] = useState([]);
          const [toast, setToast] = useState({ msg: '', show: false });
          const [isEditorOpen, setEditorOpen] = useState(false);
          const [editingTask, setEditingTask] = useState(null);
          const [guideOpen, setGuideOpen] = useState(!state.hasSeenOnboarding);

          // EFEKTLER
          useEffect(() => { localStorage.setItem('elysian_tasks', JSON.stringify(tasks)); }, [tasks]);
          useEffect(() => { localStorage.setItem('elysian_protocols', JSON.stringify(protocols)); }, [protocols]);
          useEffect(() => { localStorage.setItem('elysian_state', JSON.stringify(state)); }, [state]);
          
          useEffect(() => {
            const loader = document.getElementById('loader');
            if(loader) { loader.style.opacity = '0'; setTimeout(()=>loader.remove(),500); }
            updatePrayers();
            const interval = setInterval(updatePrayers, 60000);
            return () => clearInterval(interval);
          }, []);

          const updatePrayers = () => {
            const d = new Date(), now = d.getHours()*60 + d.getMinutes();
            // Basitleştirilmiş Namaz Vakti Hesabı (Temsili)
            const times = [{n:'İMSAK',t:300}, {n:'ÖĞLE',t:780}, {n:'İKİNDİ',t:1000}, {n:'AKŞAM',t:1200}, {n:'YATSI',t:1300}];
            setPrayerTimes(times.map(t => ({
              ...t, time: `${Math.floor(t.t/60).toString().padStart(2,'0')}:${(t.t%60).toString().padStart(2,'0')}`,
              active: now >= t.t && now < t.t+60
            })));
          };

          const showToast = (msg) => { setToast({msg, show:true}); setTimeout(()=>setToast({msg:'', show:false}), 3000); };
          
          const handleTask = (id, type) => {
             if(type === 'DEL') { setTasks(t => t.filter(x=>x.id!==id)); showToast('Görev Silindi'); return; }
             setTasks(prev => prev.map(t => {
               if(t.id !== id) return t;
               const isDone = type === 'DONE';
               setState(s => ({...s, zapScore: s.zapScore + (isDone ? t.impact || 50 : -(t.impact || 50))}));
               showToast(isDone ? 'İrade Güçlendi' : 'Geri Alındı');
               return {...t, status: isDone ? 'COMPLETED' : 'PENDING'};
             }));
          };

          return (
            <div className="min-h-screen bg-black text-white font-sans pb-32 overflow-x-hidden selection:bg-emerald-500/30">
              <div className="fixed inset-0 bg-neural-gradient pointer-events-none opacity-50"></div>
              
              {/* HEADER */}
              <header className="sticky top-0 z-40 bg-black/80 backdrop-blur-xl border-b border-white/5 px-6 py-4 flex justify-between items-center">
                <div className="flex items-center space-x-3">
                  <div className="w-8 h-8 rounded-lg bg-emerald-500/10 border border-emerald-500/40 flex items-center justify-center"><div className="w-2 h-2 bg-emerald-400 rotate-45"></div></div>
                  <h1 className="text-lg font-black tracking-tighter italic">YUSUF <span className="text-emerald-500">V5</span></h1>
                </div>
                <div className="flex items-center space-x-4">
                  <div className="flex items-center space-x-2 px-3 py-1 bg-white/5 rounded-full border border-white/5"><Zap className="text-yellow-400 w-4 h-4"/><span className="font-mono font-bold text-sm">{state.zapScore}</span></div>
                  <button onClick={()=>{if(confirm('Tüm veriler silinsin mi?')){localStorage.clear();location.reload()}}} className="text-white/30 hover:text-red-500"><Trash2 className="w-4 h-4"/></button>
                </div>
              </header>

              {/* MAIN CONTENT */}
              <main className="px-6 mt-6 relative z-10 max-w-2xl mx-auto">
                {/* PRAYER TIMES */}
                <div className="flex space-x-3 overflow-x-auto no-scrollbar mb-8 pb-2">
                  {prayerTimes.map((p,i) => (
                    <div key={i} className={`flex flex-col p-3 rounded-xl border min-w-[90px] transition-all ${p.active ? 'bg-emerald-900/20 border-emerald-500/50 shadow-[0_0_20px_rgba(16,185,129,0.1)]' : 'bg-white/5 border-white/5 opacity-50'}`}>
                      <span className="text-[9px] font-black tracking-widest text-emerald-500/80 mb-1">{p.n}</span>
                      <span className="text-lg font-mono font-bold">{p.time}</span>
                    </div>
                  ))}
                </div>

                {/* PROTOCOLS */}
                <div className="space-y-3 mb-10">
                  {protocols.map(p => (
                    <div key={p.id} onClick={()=>setProtocols(prev=>prev.map(x=>x.id===p.id?{...x,completed:!x.completed}:x))} className={`p-4 rounded-xl border flex items-center cursor-pointer transition-all ${p.completed ? 'bg-emerald-900/10 border-emerald-500/40' : 'bg-white/5 border-white/5 hover:bg-white/10'}`}>
                      <div className={`w-5 h-5 rounded border flex items-center justify-center mr-4 transition-colors ${p.completed ? 'bg-emerald-500 border-emerald-500' : 'border-white/20'}`}>
                        {p.completed && <CheckCircle2 className="w-3.5 h-3.5 text-black" />}
                      </div>
                      <span className={`font-bold text-sm ${p.completed ? 'text-emerald-400 line-through' : 'text-gray-300'}`}>{p.title}</span>
                    </div>
                  ))}
                </div>

                {/* TASKS */}
                {['Pazartesi','Salı','Çarşamba','Perşembe','Cuma','Cumartesi','Pazar'].map(day => {
                  const dTasks = tasks.filter(t=>t.day===day).sort((a,b)=>a.startTime.localeCompare(b.startTime));
                  if(!dTasks.length) return null;
                  return (
                    <div key={day} className="mb-8">
                      <div className="flex items-center mb-4"><div className="h-px bg-white/10 flex-1"/><span className="px-3 text-[10px] font-black text-emerald-600 tracking-[0.2em]">{day.toUpperCase()}</span><div className="h-px bg-white/10 flex-1"/></div>
                      <div className="space-y-3">
                        {dTasks.map(t => {
                          const isDone = t.status === 'COMPLETED';
                          const cat = CATEGORIES[t.category] || CATEGORIES.DIGER;
                          return (
                            <div key={t.id} className={`relative rounded-2xl border overflow-hidden transition-all group ${isDone ? 'bg-black/40 border-white/5 opacity-50' : 'glass-panel border-white/10 hover:border-emerald-500/30'}`}>
                              <div className={`absolute left-0 top-0 bottom-0 w-1 ${isDone ? 'bg-gray-700' : cat.color}`}/>
                              <div className="p-5 pl-6">
                                <div className="flex justify-between items-start mb-2">
                                  <span className={`text-[9px] font-black px-2 py-0.5 rounded bg-white/5 text-gray-400 mb-2 inline-block`}>{cat.label}</span>
                                  <div className="flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity">
                                    <button onClick={()=>{setEditingTask(t);setEditorOpen(true)}} className="p-1.5 hover:bg-white/10 rounded"><Edit2 className="w-3.5 h-3.5 text-gray-400"/></button>
                                    <button onClick={()=>handleTask(t.id,'DEL')} className="p-1.5 hover:bg-red-900/20 rounded"><Trash2 className="w-3.5 h-3.5 text-red-400"/></button>
                                  </div>
                                </div>
                                <h4 className={`text-base font-bold mb-3 ${isDone?'line-through text-gray-600':'text-gray-200'}`}>{t.title}</h4>
                                <div className="flex justify-between items-center pt-3 border-t border-white/5">
                                  <span className="font-mono text-xs text-gray-500">{t.startTime} - {t.endTime}</span>
                                  <button onClick={()=>handleTask(t.id, isDone?'UNDO':'DONE')} className={`px-4 py-1.5 rounded-lg text-[10px] font-black tracking-widest ${isDone?'bg-gray-800 text-gray-500':'bg-emerald-600 text-black hover:bg-emerald-500'}`}>{isDone?'GERİ AL':'TAMAMLA'}</button>
                                </div>
                              </div>
                            </div>
                          )
                        })}
                      </div>
                    </div>
                  )
                })}
              </main>

              {/* TOAST MESSAGE */}
              <div className={`fixed top-24 left-1/2 -translate-x-1/2 bg-emerald-900/80 border border-emerald-500/50 text-white px-6 py-3 rounded-full flex items-center space-x-3 backdrop-blur-md shadow-2xl transition-all duration-300 z-50 ${toast.show ? 'opacity-100 translate-y-0' : 'opacity-0 -translate-y-4 pointer-events-none'}`}>
                 <div className="w-2 h-2 bg-emerald-400 rounded-full animate-pulse"/>
                 <span className="text-xs font-bold tracking-widest">{toast.msg}</span>
              </div>

              {/* FAB */}
              <div className="fixed bottom-8 left-6 right-6 z-40">
                <button onClick={()=>{setEditingTask(null);setEditorOpen(true)}} className="w-full h-14 bg-emerald-600 hover:bg-emerald-500 rounded-2xl flex items-center justify-center shadow-[0_0_30px_rgba(16,185,129,0.3)] transition-all active:scale-95">
                  <Plus className="text-black w-6 h-6 mr-2" />
                  <span className="text-black font-black tracking-[0.2em] text-sm">GÖREV EKLE</span>
                </button>
              </div>

              {/* EDITOR MODAL */}
              {isEditorOpen && (
                <div className="fixed inset-0 z-[60] bg-black/90 backdrop-blur-sm flex items-end sm:items-center justify-center p-4">
                  <div className="w-full max-w-lg bg-[#0a0a0a] border border-white/10 rounded-3xl p-6 shadow-2xl animate-pulse-slow">
                    <div className="flex justify-between mb-6"><h3 className="font-bold">GÖREV</h3><button onClick={()=>setEditorOpen(false)}><X/></button></div>
                    <form onSubmit={(e)=>{
                      e.preventDefault();
                      const fd = new FormData(e.target);
                      const data = Object.fromEntries(fd);
                      if(editingTask) setTasks(p=>p.map(x=>x.id===editingTask.id?{...x, ...data}:x));
                      else setTasks(p=>[...p, {id:generateId(), status:'PENDING', impact:70, ...data}]);
                      setEditorOpen(false);
                      showToast(editingTask?'Güncellendi':'Eklendi');
                    }} className="space-y-4">
                      <input name="title" required defaultValue={editingTask?.title} placeholder="Görev Adı" className="w-full bg-white/5 border border-white/10 rounded-xl p-4 outline-none focus:border-emerald-500"/>
                      <div className="grid grid-cols-2 gap-4">
                        <select name="day" defaultValue={editingTask?.day||'Pazartesi'} className="bg-black border border-white/10 rounded-xl p-3 text-sm">{['Pazartesi','Salı','Çarşamba','Perşembe','Cuma','Cumartesi','Pazar'].map(d=><option key={d} value={d}>{d}</option>)}</select>
                        <select name="category" defaultValue={editingTask?.category||'DIGER'} className="bg-black border border-white/10 rounded-xl p-3 text-sm">{Object.entries(CATEGORIES).map(([k,v])=><option key={k} value={k}>{v.label}</option>)}</select>
                      </div>
                      <div className="grid grid-cols-2 gap-4">
                        <input name="startTime" type="time" required defaultValue={editingTask?.startTime} className="bg-white/5 border border-white/10 rounded-xl p-3"/>
                        <input name="endTime" type="time" required defaultValue={editingTask?.endTime} className="bg-white/5 border border-white/10 rounded-xl p-3"/>
                      </div>
                      <button className="w-full bg-emerald-600 h-12 rounded-xl text-black font-bold mt-2">KAYDET</button>
                    </form>
                  </div>
                </div>
              )}
            </div>
          );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
