<!DOCTYPE html>
<html lang="tr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ELYSIAN // PROTOCOL</title>
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <link rel="apple-touch-icon" href="https://api.iconify.design/lucide:cpu.svg?color=%2310b981">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Plus+Jakarta+Sans:ital,wght@0,400;0,700;0,800;1,400&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        elysian: {
                            black: '#000000',
                            dark: '#050505',
                            panel: 'rgba(20, 20, 20, 0.85)',
                            emerald: '#10b981',
                            cyan: '#3b82f6', // Electric Blue
                            danger: '#ef4444',
                            text: '#e2e8f0',
                            muted: '#64748b'
                        }
                    },
                    fontFamily: {
                        sans: ['"Plus Jakarta Sans"', 'sans-serif'],
                        mono: ['"JetBrains Mono"', 'monospace'],
                    },
                    animation: {
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'slide-up': 'slideUp 0.3s ease-out forwards',
                        'glitch': 'glitch 1s linear infinite',
                    },
                    keyframes: {
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>

    <!-- React & Babel -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.292.0"
        }
    }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body {
            background-color: #000000;
            color: #e2e8f0;
            overscroll-behavior-y: none; /* Disables pull-to-refresh */
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Custom Scrollbar for Cyberpunk feel */
        ::-webkit-scrollbar {
            width: 4px;
            height: 4px;
        }
        ::-webkit-scrollbar-track {
            background: #000; 
        }
        ::-webkit-scrollbar-thumb {
            background: #333; 
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #10b981; 
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }

        .modal-overlay {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
        }

        .neon-text {
            text-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
        }
        
        .safe-area-top {
            padding-top: env(safe-area-inset-top);
        }
        .safe-area-bottom {
            padding-bottom: env(safe-area-inset-bottom);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Application Logic -->
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef, useMemo, useCallback } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Brain, Activity, Zap, CheckCircle2, RotateCcw, 
            Lock, Clock, ShieldAlert, Trophy, Flame, 
            ChevronRight, AlertTriangle, Moon, Sun, 
            Calendar, X, Play, Pause, RefreshCw,
            Plus, Edit3, Trash2, Save, MoreHorizontal,
            Bell, BellOff, Cpu, BookOpen, HelpCircle, User, BarChart,
            Check, Info
        } from 'lucide-react';

        // --- AUDIO SYSTEM (Synthesized SFX) ---
        const playSound = (type) => {
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                if (!AudioContext) return;
                const ctx = new AudioContext();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                
                osc.connect(gain);
                gain.connect(ctx.destination);

                const now = ctx.currentTime;
                
                if (type === 'complete') {
                    // Success High Tech
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(880, now);
                    osc.frequency.exponentialRampToValueAtTime(1760, now + 0.1);
                    gain.gain.setValueAtTime(0.3, now);
                    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
                    osc.start(now);
                    osc.stop(now + 0.3);
                } else if (type === 'click') {
                    // Mechanical Click
                    osc.type = 'square';
                    osc.frequency.setValueAtTime(200, now);
                    gain.gain.setValueAtTime(0.05, now);
                    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.05);
                    osc.start(now);
                    osc.stop(now + 0.05);
                } else if (type === 'error') {
                    // Access Denied / Punishment
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(100, now);
                    osc.frequency.linearRampToValueAtTime(50, now + 0.4);
                    gain.gain.setValueAtTime(0.3, now);
                    gain.gain.linearRampToValueAtTime(0.01, now + 0.4);
                    osc.start(now);
                    osc.stop(now + 0.4);
                } else if (type === 'reset') {
                     // Reset / Reload sound
                    osc.type = 'triangle';
                    osc.frequency.setValueAtTime(100, now);
                    osc.frequency.linearRampToValueAtTime(800, now + 0.5);
                    gain.gain.setValueAtTime(0.2, now);
                    gain.gain.linearRampToValueAtTime(0.01, now + 0.5);
                    osc.start(now);
                    osc.stop(now + 0.5);
                }
            } catch (e) {
                console.error("Audio protocol failed", e);
            }
        };

        // --- RANKS SYSTEM ---
        const RANKS = [
            { level: 1, name: "BAŞLANGIÇ (NOVICE)", minXp: 0 },
            { level: 5, name: "ÇIRAK (APPRENTICE)", minXp: 500 },
            { level: 10, name: "OPERATÖR (OPERATOR)", minXp: 2000 },
            { level: 20, name: "SİBER-KEŞİŞ (CYBER-MONK)", minXp: 5000 },
            { level: 35, name: "NEURAL MİMAR (ARCHITECT)", minXp: 10000 },
            { level: 50, name: "ELYSIAN (ASCENDED)", minXp: 25000 },
        ];

        const calculateLevel = (xp) => {
            return Math.floor(Math.sqrt(xp / 50)) + 1;
        };

        const getRankName = (level) => {
            let currentRank = RANKS[0];
            for (let r of RANKS) {
                if (level >= r.level) currentRank = r;
            }
            return currentRank.name;
        };

        const getXpForNextLevel = (level) => {
            return Math.pow(level, 2) * 50;
        };

        // --- PRAYER TIMES ENGINE (ISTANBUL OPTIMIZED) ---
        // Coordinates: Istanbul (41.0082, 28.9784)
        // Method: Astronomical Calculation with Diyanet Offsets (Temkin)
        // Diyanet Method: Fajr 18°, Isha 17°
        const calculatePrayerTimesIstanbul = (date) => {
            const latitude = 41.0082;
            const longitude = 28.9784;
            const timezone = 3; // UTC+3

            // Helper: Degrees to Radians and vice versa
            const D2R = d => d * (Math.PI / 180);
            const R2D = r => r * (180 / Math.PI);

            // Julian Date
            const dayOfYear = (d) => {
                const start = new Date(d.getFullYear(), 0, 0);
                const diff = d - start;
                const oneDay = 1000 * 60 * 60 * 24;
                return Math.floor(diff / oneDay);
            };
            
            // Solar Position (Approximate High Precision)
            const J = dayOfYear(date);
            const declination = 23.45 * Math.sin(D2R(360 / 365 * (284 + J)));
            const B = D2R(360 / 365 * (J - 81));
            const eqTime = 9.87 * Math.sin(2 * B) - 7.53 * Math.cos(B) - 1.5 * Math.sin(B); // Minutes

            // Solar Noon (Zawal)
            // Time = (12h - (Lng / 15)) - EqT/60 + Timezone
            const solarNoonRaw = 12 - (longitude / 15) - (eqTime / 60) + timezone;

            // Hour Angle Calculation
            // cos(H) = (sin(Altitude) - sin(Lat)*sin(Dec)) / (cos(Lat)*cos(Dec))
            const calcHourAngle = (angle) => {
                const term = (Math.sin(D2R(angle)) - Math.sin(D2R(latitude)) * Math.sin(D2R(declination))) / 
                             (Math.cos(D2R(latitude)) * Math.cos(D2R(declination)));
                if (term > 1 || term < -1) return 0; // Polar day/night
                return R2D(Math.acos(term)) / 15;
            };

            // 1. IMSAK (Fajr): Sun is 18 degrees below horizon
            const imsakDiff = calcHourAngle(-18);
            const imsakTime = solarNoonRaw - imsakDiff;

            // 2. GUNES (Sunrise): Sun is 0.833 deg below horizon
            const sunDiff = calcHourAngle(-0.833);
            const sunTime = solarNoonRaw - sunDiff;

            // 3. OGLE (Dhuhr): Solar Noon
            const ogleTime = solarNoonRaw;

            // 4. IKINDI (Asr): Shadow Length = 1 (Standard/Diyanet)
            // Alt = acot(1 + tan(abs(lat - dec)))
            const asrAlt = R2D(Math.atan(1 / (1 + Math.tan(D2R(Math.abs(latitude - declination))))));
            const asrDiff = calcHourAngle(asrAlt);
            const ikindiTime = solarNoonRaw + asrDiff;

            // 5. AKSAM (Maghrib): Sun is 0.833 deg below horizon (Sunset)
            const aksamTime = solarNoonRaw + sunDiff;

            // 6. YATSI (Isha): Sun is 17 degrees below horizon
            const yatsiDiff = calcHourAngle(-17);
            const yatsiTime = solarNoonRaw + yatsiDiff;

            // --- TEMKIN (SAFETY) OFFSETS FOR ISTANBUL (Typical Diyanet margins) ---
            // These shift the astronomical time to match the calendar
            const offsets = {
                imsak: -4,  
                gunes: -5,  
                ogle: +5,   
                ikindi: +4, 
                aksam: +7,  
                yatsi: +2   
            };

            const floatToTime = (h, offsetMin) => {
                let totalMin = (h * 60) + offsetMin;
                let hours = Math.floor(totalMin / 60);
                let minutes = Math.floor(totalMin % 60);

                if (minutes >= 60) { hours++; minutes -= 60; }
                if (minutes < 0) { hours--; minutes += 60; }
                if (hours >= 24) hours -= 24;
                if (hours < 0) hours += 24;

                // Strict 2-digit formatting "18:00"
                return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
            };

            return [
                { name: 'İMSAK', time: floatToTime(imsakTime, offsets.imsak) },
                { name: 'GÜNEŞ', time: floatToTime(sunTime, offsets.gunes) },
                { name: 'ÖĞLE', time: floatToTime(ogleTime, offsets.ogle) },
                { name: 'İKİNDİ', time: floatToTime(ikindiTime, offsets.ikindi) },
                { name: 'AKŞAM', time: floatToTime(aksamTime, offsets.aksam) },
                { name: 'YATSI', time: floatToTime(yatsiTime, offsets.yatsi) },
            ];
        };

        // --- CONSTANTS ---
        const DAYS = [
            { id: 1, name: 'PAZARTESİ', short: 'PTS' },
            { id: 2, name: 'SALI', short: 'SAL' },
            { id: 3, name: 'ÇARŞAMBA', short: 'ÇAR' },
            { id: 4, name: 'PERŞEMBE', short: 'PER' },
            { id: 5, name: 'CUMA', short: 'CUM' },
            { id: 6, name: 'CUMARTESİ', short: 'CTS' },
            { id: 0, name: 'PAZAR', short: 'PAZ' },
        ];

        const CATEGORIES = ['İNGİLİZCE', 'SPOR', 'MÜŞTERİ', 'OKUMA', 'STRATEJİ', 'SAĞLIK', 'NAMAZ', 'DİĞER'];
        
        const IMPACTS = [
            { id: 'LOW', label: 'DÜŞÜK', xp: 50 },
            { id: 'MED', label: 'ORTA', xp: 75 },
            { id: 'HIGH', label: 'YÜKSEK', xp: 100 },
            { id: 'CRITICAL', label: 'KRİTİK', xp: 150 },
        ];

        const DEFAULT_ROUTINE = {
            1: [ 
                { id: 'm_sabah', title: 'Sabah Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
                { id: 'm1', title: 'İngilizce ders', category: 'İNGİLİZCE', time: '08:30', completed: false, snoozed: 0, impact: 'HIGH' },
                { id: 'm2', title: 'Omuz & bilek bide triceps', category: 'SPOR', time: '10:00', completed: false, snoozed: 0, impact: 'HIGH' },
                { id: 'm3', title: 'Müşteri İşleri/Görüşme', category: 'MÜŞTERİ', time: '12:00', completed: false, snoozed: 0, impact: 'HIGH' },
                { id: 'm_ogle', title: 'Öğle Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
                { id: 'm_ikindi', title: 'İkindi Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
                { id: 'm4', title: 'Bence oku ama filmde izleyebilirsin', category: 'OKUMA', time: '17:30', completed: false, snoozed: 0, impact: 'MED' },
                { id: 'm_aksam', title: 'Akşam Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
                { id: 'm5', title: 'Bak kendini geliştir ama sosyallikte olabilir gibi', category: 'STRATEJİ', time: '19:30', completed: false, snoozed: 0, impact: 'MED' },
                { id: 'm_yatsi', title: 'Yatsı Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
            ],
            2: [ 
                { id: 't_sabah', title: 'Sabah Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
                { id: 't1', title: 'İngilizce ders', category: 'İNGİLİZCE', time: '08:30', completed: false, snoozed: 0, impact: 'HIGH' },
                { id: 't2', title: 'Bacak günü (sakın es geçme)', category: 'SPOR', time: '10:00', completed: false, snoozed: 0, impact: 'CRITICAL' },
                { id: 't3', title: 'Müşteri işleri/Görüşme', category: 'MÜŞTERİ', time: '12:00', completed: false, snoozed: 0, impact: 'HIGH' },
                { id: 't_ogle', title: 'Öğle Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
                { id: 't_ikindi', title: 'İkindi Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
                { id: 't4', title: 'Ben diyeyim okuma sen de dizi izle', category: 'OKUMA', time: '17:30', completed: false, snoozed: 0, impact: 'MED' },
                { id: 't_aksam', title: 'Akşam Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
                { id: 't5', title: 'Tamam bugün serbestsin', category: 'SAĞLIK', time: '19:30', completed: false, snoozed: 0, impact: 'HIGH' },
                { id: 't_yatsi', title: 'Yatsı Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
            ],
            3: [ 
                { id: 'w_sabah', title: 'Sabah Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
                { id: 'w1', title: 'İngilizce ders', category: 'İNGİLİZCE', time: '09:30', completed: false, snoozed: 0, impact: 'HIGH' },
                { id: 'w2', title: 'Müşteri İşleri/Görüşme', category: 'MÜŞTERİ', time: '11:30', completed: false, snoozed: 0, impact: 'HIGH' },
                { id: 'w_ogle', title: 'Öğle Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
                { id: 'w_ikindi', title: 'İkindi Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
                { id: 'w3', title: 'Bu sefer okuyacan kaçış yok', category: 'OKUMA', time: '16:30', completed: false, snoozed: 0, impact: 'HIGH' },
                { id: 'w4', title: 'Bugünde çıkmayıver', category: 'STRATEJİ', time: '19:00', completed: false, snoozed: 0, impact: 'MED' },
                { id: 'w_aksam', title: 'Akşam Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
                { id: 'w_yatsi', title: 'Yatsı Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
            ],
            4: [ 
                { id: 'th_sabah', title: 'Sabah Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
                { id: 'th1', title: 'İngilizce ders', category: 'İNGİLİZCE', time: '08:30', completed: false, snoozed: 0, impact: 'HIGH' },
                { id: 'th2', title: 'Sırt & Ön Kol Bide Trapez', category: 'SPOR', time: '10:00', completed: false, snoozed: 0, impact: 'HIGH' },
                { id: 'th3', title: 'Müşteri İşleri/Görüşme', category: 'MÜŞTERİ', time: '12:00', completed: false, snoozed: 0, impact: 'HIGH' },
                { id: 'th_ogle', title: 'Öğle Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
                { id: 'th_ikindi', title: 'İkindi Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
                { id: 'th4', title: 'Dizi mi izliyecen okuyacan mi senin iradene kalmış', category: 'OKUMA', time: '17:30', completed: false, snoozed: 0, impact: 'MED' },
                { id: 'th_aksam', title: 'Akşam Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
                { id: 'th5', title: 'Çık bi hava al yada kendini geliştir', category: 'STRATEJİ', time: '19:00', completed: false, snoozed: 0, impact: 'MED' },
                { id: 'th_yatsi', title: 'Yatsı Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
            ],
            5: [ // Friday
                { id: 'f_sabah', title: 'Sabah Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
                { id: 'f1', title: 'İngilizce ders', category: 'İNGİLİZCE', time: '09:00', completed: false, snoozed: 0, impact: 'HIGH' },
                { id: 'f2', title: 'Cuma saatine kadar sarar, kendini geliştir', category: 'STRATEJİ', time: '10:30', completed: false, snoozed: 0, impact: 'MED' },
                { id: 'f3', title: 'Cuma Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
                { id: 'f4', title: 'Müşteri İşleri/Görüşme', category: 'MÜŞTERİ', time: '14:30', completed: false, snoozed: 0, impact: 'HIGH' },
                { id: 'f_ikindi', title: 'İkindi Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
                { id: 'f5', title: 'Kafana göre', category: 'SAĞLIK', time: '19:00', completed: false, snoozed: 0, impact: 'HIGH' },
                { id: 'f_aksam', title: 'Akşam Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
                { id: 'f_yatsi', title: 'Yatsı Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
            ],
            6: [ 
                { id: 's_sabah', title: 'Sabah Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
                { id: 's_ogle', title: 'Öğle Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
                { id: 's1', title: 'Gelecek Hafta Planlama', category: 'STRATEJİ', time: '14:00', completed: false, snoozed: 0, impact: 'HIGH' },
                { id: 's_ikindi', title: 'İkindi Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
                { id: 's_aksam', title: 'Akşam Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
                { id: 's_yatsi', title: 'Yatsı Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
            ],
            0: [ // Sunday
                { id: 'su_sabah', title: 'Sabah Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
                { id: 'su1', title: 'Tam Dinlenme', category: 'SAĞLIK', time: '00:00', completed: false, snoozed: 0, impact: 'HIGH' },
                { id: 'su_ogle', title: 'Öğle Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
                { id: 'su_ikindi', title: 'İkindi Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
                { id: 'su_aksam', title: 'Akşam Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
                { id: 'su_yatsi', title: 'Yatsı Namazı', category: 'NAMAZ', time: '', completed: false, snoozed: 0, impact: 'CRITICAL' },
            ]
        };

        const CATEGORY_COLORS = {
            'İNGİLİZCE': 'text-blue-400 border-blue-400/30 bg-blue-400/10',
            'SPOR': 'text-indigo-400 border-indigo-400/30 bg-indigo-400/10',
            'MÜŞTERİ': 'text-amber-400 border-amber-400/30 bg-amber-400/10',
            'NAMAZ': 'text-teal-400 border-teal-400/30 bg-teal-400/10',
            'OKUMA': 'text-pink-400 border-pink-400/30 bg-pink-400/10',
            'STRATEJİ': 'text-purple-400 border-purple-400/30 bg-purple-400/10',
            'SAĞLIK': 'text-green-400 border-green-400/30 bg-green-400/10',
            'DİĞER': 'text-gray-400 border-gray-400/30 bg-gray-400/10',
            'CRITICAL': 'text-red-500 border-red-500/50 bg-red-500/10'
        };

        // --- COMPONENTS ---

        const ErrorFallback = ({ reset }) => (
            <div className="fixed inset-0 bg-black z-[100] flex flex-col items-center justify-center p-8 font-mono text-red-500">
                <AlertTriangle size={64} className="mb-4 animate-pulse" />
                <h1 className="text-2xl font-bold mb-2">CRITICAL FAILURE</h1>
                <button onClick={reset} className="px-6 py-3 border border-red-500 bg-red-900/20 text-sm font-bold mt-4">REBOOT SYSTEM</button>
            </div>
        );

        const ManualModal = ({ isOpen, onClose }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-[60] flex items-center justify-center p-4">
                    <div className="absolute inset-0 modal-overlay" onClick={onClose}></div>
                    <div className="relative w-full max-w-2xl bg-[#0a0a0a] border border-elysian-emerald/30 rounded-2xl overflow-hidden flex flex-col max-h-[85vh] shadow-[0_0_30px_rgba(16,185,129,0.2)] animate-slide-up">
                        <div className="p-6 border-b border-white/10 flex justify-between items-center bg-white/5">
                             <h2 className="text-xl font-bold font-sans text-white tracking-tight flex items-center gap-2">
                                <BookOpen size={20} className="text-elysian-emerald"/> SİSTEM KILAVUZU v3.0
                            </h2>
                            <button onClick={onClose}><X className="text-gray-500 hover:text-white" /></button>
                        </div>
                        <div className="p-8 overflow-y-auto space-y-8 font-mono text-sm text-gray-300 custom-scrollbar">
                            
                            <section>
                                <h3 className="text-elysian-emerald font-bold mb-3 flex items-center gap-2"><Brain size={16}/> FELSEFE: NEURAL DISCIPLINE</h3>
                                <p className="opacity-80 leading-relaxed mb-2">
                                    Elysian Protocol, sıradan bir "to-do list" değildir. Burası, dopamin reseptörlerinizi yeniden yapılandırmak için tasarlanmış bir sinirsel eğitim sahasıdır. 
                                    Amaç: Modern dünyanın dikkat dağıtıcı kaosuna (Entropi) karşı, iradenizi (Negentropi) güçlendirmek.
                                </p>
                                <p className="opacity-80 leading-relaxed">
                                    <span className="text-elysian-cyan">Zen Modu:</span> Görevlere odaklanırken dış dünyayı tamamen izole eder. Sadece siz ve hedefiniz kalırsınız.
                                </p>
                            </section>

                            <section>
                                <h3 className="text-elysian-emerald font-bold mb-3 flex items-center gap-2"><Activity size={16}/> MEKANİKLER & KURALLAR</h3>
                                <ul className="space-y-3 opacity-80">
                                    <li className="flex gap-2">
                                        <span className="text-elysian-emerald">XP & Rütbe:</span> 
                                        <span>Her tamamlanan görev XP kazandırır. XP biriktikçe rütbeniz yükselir (Novice -> Ascended). Bu, iradenizin somut bir ölçütüdür.</span>
                                    </li>
                                    <li className="flex gap-2">
                                        <span className="text-red-400">Ceza (Kortizol):</span> 
                                        <span>Bir görevi iptal etmek veya ertelemek (snooze) XP kaybına neden olur. Disiplinsizlik bedel ödetir.</span>
                                    </li>
                                    <li className="flex gap-2">
                                        <span className="text-amber-400">Haftalık Döngü:</span> 
                                        <span>Pazar günleri listenin en altında "Haftayı Tamamla" butonu belirir. Bu, XP'nizi veya rütbenizi SİLMEZ. Sadece görev tiklerini kaldırır ve sistemi yeni haftaya hazırlar.</span>
                                    </li>
                                </ul>
                            </section>

                            <section>
                                <h3 className="text-elysian-emerald font-bold mb-3 flex items-center gap-2"><Moon size={16}/> MANEVİ SENKRONİZASYON (NAMAZ)</h3>
                                <div className="bg-white/5 p-4 rounded border border-white/5">
                                    <p className="mb-2">
                                        Namaz vakitleri, <strong>İstanbul (Avrupa)</strong> koordinatlarına göre, astronomik formüller kullanılarak hesaplanır.
                                        Ancak, Diyanet takvimiyle uyumlu olması için özel <strong>"Temkin" (Güvenlik Payı)</strong> algoritmaları entegre edilmiştir.
                                    </p>
                                    <ul className="text-xs space-y-1 text-gray-500 mt-2">
                                        <li>• İmsak: Astronomik -4 dk</li>
                                        <li>• Öğle: Astronomik +5 dk</li>
                                        <li>• İkindi: Astronomik +4 dk</li>
                                        <li>• Akşam: Astronomik +7 dk</li>
                                    </ul>
                                    <p className="mt-3 text-elysian-cyan">
                                        Not: Namaz görevleri, zihinsel karışıklığı önlemek için listenin en altında, yatay ve ayrı bir panelde tutulur.
                                    </p>
                                </div>
                            </section>

                        </div>
                    </div>
                </div>
            );
        };

        const BioMetrics = ({ xp, tasks, routine }) => {
            const level = calculateLevel(xp);
            const rankName = getRankName(level);
            const nextLevelXp = getXpForNextLevel(level);
            const prevLevelXp = getXpForNextLevel(level - 1);
            const progressToNext = Math.min(100, Math.max(0, ((xp - prevLevelXp) / (nextLevelXp - prevLevelXp)) * 100)) || 0;

            const totalTasks = tasks.length || 1;
            const completedTasks = tasks.filter(t => t.completed).length;
            
            // Calculate consistency across ALL days in the routine
            const daysGraph = DAYS.map(d => {
                const dTasks = routine[d.id] || [];
                if (dTasks.length === 0) return { day: d.short, val: 0, active: false };
                const dComp = dTasks.filter(t => t.completed).length;
                return { day: d.short, val: (dComp / dTasks.length) * 100, active: true };
            });

            return (
                <div className="glass-panel p-4 rounded-xl space-y-6 mb-4">
                    {/* LEVEL / RANK SECTION */}
                    <div className="flex items-center justify-between">
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 rounded bg-white/5 flex items-center justify-center border border-elysian-emerald text-elysian-emerald font-bold font-mono text-lg shadow-[0_0_10px_rgba(16,185,129,0.3)]">
                                {level}
                            </div>
                            <div>
                                <div className="text-[10px] text-gray-500 font-mono tracking-widest uppercase">Mevcut Rütbe</div>
                                <div className="text-white font-bold font-sans">{rankName}</div>
                            </div>
                        </div>
                        <div className="text-right">
                             <div className="text-[10px] text-gray-500 font-mono tracking-widest uppercase">Sonraki Seviye</div>
                             <div className="text-elysian-emerald font-mono text-xs">{Math.round(nextLevelXp - xp)} XP Kaldı</div>
                        </div>
                    </div>
                    {/* XP BAR */}
                    <div className="h-1 bg-gray-800 w-full rounded-full overflow-hidden">
                        <div className="h-full bg-elysian-emerald shadow-[0_0_10px_#10b981]" style={{ width: `${progressToNext}%` }}></div>
                    </div>

                    {/* WEEKLY CONSISTENCY GRAPH */}
                    <div className="pt-2">
                        <div className="flex items-center gap-2 text-[10px] font-mono text-gray-500 mb-2">
                            <BarChart size={10} /> HAFTALIK İSTİKRAR (MANEVİ + MADDİ)
                        </div>
                        <div className="flex justify-between items-end h-8 gap-1">
                            {daysGraph.map(d => (
                                <div key={d.day} className="flex-1 flex flex-col items-center gap-1 group">
                                    <div className="w-full bg-gray-800 rounded-sm relative h-full overflow-hidden">
                                        <div 
                                            className={`absolute bottom-0 left-0 right-0 transition-all duration-500 ${d.val >= 100 ? 'bg-elysian-emerald' : d.val > 0 ? 'bg-elysian-cyan' : 'bg-transparent'}`}
                                            style={{ height: `${d.active ? d.val : 0}%` }}
                                        ></div>
                                    </div>
                                    <span className="text-[8px] text-gray-600">{d.day.substring(0,1)}</span>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const ZenMode = ({ active, task, onClose }) => {
            const [timer, setTimer] = useState(25 * 60);
            const [isActive, setIsActive] = useState(false);

            useEffect(() => {
                let interval = null;
                if (isActive && timer > 0) {
                    interval = setInterval(() => setTimer(t => t - 1), 1000);
                } else if (timer === 0) {
                    playSound('complete');
                    setIsActive(false);
                }
                return () => clearInterval(interval);
            }, [isActive, timer]);

            if (!active) return null;

            const minutes = Math.floor(timer / 60);
            const seconds = timer % 60;

            return (
                <div className="fixed inset-0 z-50 bg-black flex flex-col items-center justify-center p-6 animate-fade-in">
                    <div className="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 pointer-events-none"></div>
                    <div className="text-center space-y-8 relative z-10">
                        <div className="text-elysian-cyan animate-pulse-slow">
                            <Brain size={64} className="mx-auto" />
                        </div>
                        <h2 className="text-3xl font-bold font-sans tracking-tight text-white">{task?.title || 'DERİN ODAK'}</h2>
                        <div className="text-8xl font-mono font-bold text-transparent bg-clip-text bg-gradient-to-b from-white to-gray-600">
                            {minutes.toString().padStart(2, '0')}:{seconds.toString().padStart(2, '0')}
                        </div>
                        <div className="flex gap-4 justify-center">
                            <button onClick={() => { setIsActive(!isActive); playSound('click'); }} className="p-4 rounded-full border border-white/20 hover:bg-white/10">
                                {isActive ? <Pause /> : <Play />}
                            </button>
                            <button onClick={onClose} className="p-4 rounded-full border border-red-500/20 text-red-400 hover:bg-red-500/10">
                                <X />
                            </button>
                        </div>
                        <p className="text-xs uppercase tracking-[0.3em] text-gray-500">Dış Dünyayı Yoksay</p>
                    </div>
                </div>
            );
        };

        const TaskEditor = ({ isOpen, onClose, onSave, onDelete, initialData }) => {
            const [title, setTitle] = useState('');
            const [category, setCategory] = useState('DİĞER');
            const [time, setTime] = useState('09:00');
            const [impact, setImpact] = useState('MED');

            useEffect(() => {
                if (isOpen) {
                    setTitle(initialData?.title || '');
                    setCategory(initialData?.category || 'DİĞER');
                    setTime(initialData?.time || '09:00');
                    setImpact(initialData?.impact || 'MED');
                }
            }, [isOpen, initialData]);

            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 z-50 flex items-end sm:items-center justify-center pointer-events-none">
                    <div className="absolute inset-0 modal-overlay pointer-events-auto" onClick={onClose}></div>
                    <div className="relative w-full max-w-md bg-[#111] border-t border-elysian-emerald/30 sm:border sm:rounded-2xl p-6 pointer-events-auto transform transition-transform duration-300 animate-slide-up safe-area-bottom">
                        <div className="flex justify-between items-center mb-6">
                            <h3 className="text-elysian-emerald font-mono font-bold tracking-widest">
                                {initialData ? 'PROTOKOL GÜNCELLE' : 'YENİ PROTOKOL'}
                            </h3>
                            <button onClick={onClose} className="text-gray-500 hover:text-white"><X size={20}/></button>
                        </div>

                        <div className="space-y-4">
                            <div>
                                <label className="block text-xs font-mono text-gray-500 mb-1">GÖREV BAŞLIĞI</label>
                                <input 
                                    value={title}
                                    onChange={(e) => setTitle(e.target.value)}
                                    className="w-full bg-white/5 border border-white/10 rounded p-3 text-white focus:border-elysian-emerald outline-none font-sans"
                                    placeholder="Örn: İngilizce Kelime Ezberi"
                                    autoFocus
                                />
                            </div>

                            <div className="flex gap-4">
                                <div className="flex-1">
                                    <label className="block text-xs font-mono text-gray-500 mb-1">ZAMAN</label>
                                    <input 
                                        type="time"
                                        value={time}
                                        onChange={(e) => setTime(e.target.value)}
                                        className="w-full bg-white/5 border border-white/10 rounded p-3 text-white focus:border-elysian-emerald outline-none"
                                    />
                                </div>
                                <div className="flex-1">
                                    <label className="block text-xs font-mono text-gray-500 mb-1">ÖNEM</label>
                                    <select 
                                        value={impact}
                                        onChange={(e) => setImpact(e.target.value)}
                                        className="w-full bg-white/5 border border-white/10 rounded p-3 text-white focus:border-elysian-emerald outline-none appearance-none"
                                    >
                                        {IMPACTS.map(i => <option key={i.id} value={i.id}>{i.label}</option>)}
                                    </select>
                                </div>
                            </div>

                            <div>
                                <label className="block text-xs font-mono text-gray-500 mb-2">KATEGORİ</label>
                                <div className="flex flex-wrap gap-2">
                                    {CATEGORIES.filter(c => c !== 'NAMAZ').map(c => (
                                        <button
                                            key={c}
                                            onClick={() => setCategory(c)}
                                            className={`text-[10px] px-2 py-1 rounded border transition-all ${category === c ? 'bg-elysian-emerald text-black border-elysian-emerald' : 'bg-white/5 text-gray-400 border-white/10'}`}
                                        >
                                            {c}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            <div className="pt-4 flex gap-3">
                                {initialData && (
                                    <button 
                                        onClick={() => onDelete(initialData.id)}
                                        className="p-3 rounded border border-red-500/30 text-red-500 hover:bg-red-500/10"
                                    >
                                        <Trash2 size={20} />
                                    </button>
                                )}
                                <button 
                                    onClick={() => onSave({ title, category, time, impact })}
                                    disabled={!title}
                                    className="flex-1 p-3 bg-elysian-emerald text-black font-bold rounded hover:bg-emerald-400 disabled:opacity-50 disabled:cursor-not-allowed flex justify-center items-center gap-2"
                                >
                                    <Save size={18} />
                                    {initialData ? 'GÜNCELLE' : 'SİSTEME YÜKLE'}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            // --- STATE ---
            const [mounted, setMounted] = useState(false);
            const [xp, setXp] = useState(0);
            const [streak, setStreak] = useState(0);
            const [currentDate, setCurrentDate] = useState(new Date());
            const [selectedDayId, setSelectedDayId] = useState(new Date().getDay()); // 0-6
            const [weeklyRoutine, setWeeklyRoutine] = useState(DEFAULT_ROUTINE);
            const [prayerTimes, setPrayerTimes] = useState([]);
            const [zenMode, setZenMode] = useState({ active: false, task: null });
            const [modalOpen, setModalOpen] = useState(false);
            const [manualOpen, setManualOpen] = useState(false);
            const [editingTask, setEditingTask] = useState(null);
            const [message, setMessage] = useState(null);
            
            // --- PERSISTENCE ---
            useEffect(() => {
                const loadData = () => {
                    try {
                        const saved = localStorage.getItem('elysian_core_v3');
                        if (saved) {
                            const parsed = JSON.parse(saved);
                            setXp(parsed.xp || 0);
                            setStreak(parsed.streak || 0);
                            const mergedRoutine = { ...DEFAULT_ROUTINE, ...parsed.weeklyRoutine };
                            setWeeklyRoutine(mergedRoutine);
                        }
                    } catch (e) {
                        console.error("Memory corrupted", e);
                    }
                };
                loadData();
                setMounted(true);
            }, []);

            useEffect(() => {
                if (!mounted) return;
                const data = { xp, streak, weeklyRoutine, lastLogin: new Date().toISOString() };
                localStorage.setItem('elysian_core_v3', JSON.stringify(data));
            }, [xp, streak, weeklyRoutine, mounted]);

            // --- CLOCK & CALC ---
            useEffect(() => {
                const tick = () => {
                    const now = new Date();
                    setCurrentDate(now);
                    setPrayerTimes(calculatePrayerTimesIstanbul(now));
                };
                tick();
                const timer = setInterval(tick, 60000); // Update every minute
                return () => clearInterval(timer);
            }, []);


            // --- ACTIONS ---
            const showToast = (msg) => {
                setMessage(msg);
                setTimeout(() => setMessage(null), 3000);
            };

            const handleDaySelect = (dayId) => {
                setSelectedDayId(dayId);
                playSound('click');
            };

            const toggleTask = (taskId) => {
                setWeeklyRoutine(prev => {
                    const dayTasks = [...(prev[selectedDayId] || [])];
                    const taskIndex = dayTasks.findIndex(t => t.id === taskId);
                    if (taskIndex === -1) return prev;

                    const task = dayTasks[taskIndex];
                    const newStatus = !task.completed;
                    
                    if (newStatus) {
                        playSound('complete');
                        const points = IMPACTS.find(i => i.id === task.impact)?.xp || 50;
                        setXp(x => x + points);
                        showToast(`BAĞLANTI GÜÇLENDİ: +${points} XP`);
                    } else {
                        const points = IMPACTS.find(i => i.id === task.impact)?.xp || 50;
                        setXp(x => Math.max(0, x - points));
                    }

                    dayTasks[taskIndex] = { ...task, completed: newStatus };
                    return { ...prev, [selectedDayId]: dayTasks };
                });
            };

            const snoozeTask = (taskId) => {
                setWeeklyRoutine(prev => {
                    const dayTasks = [...(prev[selectedDayId] || [])];
                    const taskIndex = dayTasks.findIndex(t => t.id === taskId);
                    const task = dayTasks[taskIndex];

                    if (task.completed || task.snoozed >= 2) {
                        playSound('error');
                        return prev;
                    }

                    playSound('error');
                    const penalty = 25;
                    setXp(x => Math.max(0, x - penalty));
                    showToast(`KORTİZOL ARTISI: -${penalty} XP`);

                    dayTasks[taskIndex] = { ...task, snoozed: task.snoozed + 1 };
                    return { ...prev, [selectedDayId]: dayTasks };
                });
            };

            const handleSaveTask = (taskData) => {
                setWeeklyRoutine(prev => {
                    const dayTasks = [...(prev[selectedDayId] || [])];
                    if (editingTask) {
                        const index = dayTasks.findIndex(t => t.id === editingTask.id);
                        if (index !== -1) dayTasks[index] = { ...dayTasks[index], ...taskData };
                        showToast("PROTOKOL GÜNCELLENDİ");
                    } else {
                        dayTasks.push({
                            id: Date.now().toString(),
                            completed: false,
                            snoozed: 0,
                            ...taskData
                        });
                        showToast("YENİ PROTOKOL EKLENDİ");
                    }
                    // Sort standard tasks by time
                    dayTasks.sort((a, b) => a.time.localeCompare(b.time));
                    return { ...prev, [selectedDayId]: dayTasks };
                });
                setModalOpen(false);
                setEditingTask(null);
                playSound('complete');
            };

            const handleDeleteTask = (taskId) => {
                if(!confirm("Protokolü silmek istiyor musunuz?")) return;
                setWeeklyRoutine(prev => {
                    const dayTasks = prev[selectedDayId].filter(t => t.id !== taskId);
                    return { ...prev, [selectedDayId]: dayTasks };
                });
                setModalOpen(false);
                setEditingTask(null);
                playSound('error');
            };

            const finishWeek = () => {
                if(!confirm("Haftayı tamamlayıp yeni haftayı başlatmak istiyor musunuz? (XP silinmez, görevler yenilenir)")) return;
                
                setWeeklyRoutine(prev => {
                    const newRoutine = { ...prev };
                    Object.keys(newRoutine).forEach(dayKey => {
                        newRoutine[dayKey] = newRoutine[dayKey].map(t => ({
                            ...t,
                            completed: false,
                            snoozed: 0
                        }));
                    });
                    return newRoutine;
                });
                playSound('reset');
                showToast("SİSTEM YENİLENDİ. YENİ HAFTA BAŞLADI.");
            };

            const openAddModal = () => {
                setEditingTask(null);
                setModalOpen(true);
                playSound('click');
            };

            const openEditModal = (task, e) => {
                e.stopPropagation();
                setEditingTask(task);
                setModalOpen(true);
                playSound('click');
            };

            const openZen = (task) => {
                setZenMode({ active: true, task });
                playSound('click');
            }

            // --- RENDER HELPERS ---
            const allTasks = weeklyRoutine[selectedDayId] || [];
            // Separate Prayer tasks from Standard tasks for optimized brain processing
            const prayerTasks = allTasks.filter(t => t.category === 'NAMAZ');
            const standardTasks = allTasks.filter(t => t.category !== 'NAMAZ');

            const currentPrayerIndex = useMemo(() => {
                const nowMinutes = currentDate.getHours() * 60 + currentDate.getMinutes();
                const pTimes = prayerTimes.map(p => {
                    const [h, m] = p.time.split(':').map(Number);
                    return h * 60 + m;
                });
                for (let i = pTimes.length - 1; i >= 0; i--) {
                    if (nowMinutes >= pTimes[i]) return i;
                }
                return 5;
            }, [prayerTimes, currentDate]);

            const selectedDayName = DAYS.find(d => d.id === selectedDayId)?.name;
            const isToday = selectedDayId === new Date().getDay();

            if (!mounted) return <div className="bg-black h-screen w-screen flex items-center justify-center text-elysian-emerald font-mono animate-pulse">SİSTEM BAŞLATILIYOR...</div>;

            return (
                <div className="min-h-screen pb-36 font-sans text-elysian-text selection:bg-elysian-emerald selection:text-black">
                    {/* BACKGROUND */}
                    <div className="fixed inset-0 bg-gradient-to-b from-black via-[#050505] to-black z-[-1]"></div>
                    <div className="fixed top-0 left-0 right-0 h-64 bg-elysian-emerald/5 blur-[100px] rounded-full pointer-events-none"></div>

                    {/* HEADER */}
                    <header className="fixed top-0 left-0 right-0 z-40 bg-black/90 backdrop-blur-md border-b border-white/5 safe-area-top">
                        <div className="flex items-center justify-between px-6 py-4">
                            <div className="flex items-center gap-3">
                                <div className={`w-2 h-2 rounded-full ${isToday ? 'bg-elysian-emerald animate-pulse' : 'bg-gray-600'}`}></div>
                                <span className="font-mono text-xs tracking-[0.2em] text-gray-400">ELYSIAN OS v3.0</span>
                            </div>
                            <div className="flex items-center gap-4">
                                <button onClick={() => setManualOpen(true)} className="text-gray-500 hover:text-white transition-colors"><HelpCircle size={18} /></button>
                                <div className="flex items-center gap-2 text-amber-500 font-mono text-sm"><Flame size={14} fill="currentColor" /><span>{streak}</span></div>
                                <div className="flex items-center gap-2 text-elysian-emerald font-mono text-sm"><Zap size={14} fill="currentColor" /><span>{xp}</span></div>
                            </div>
                        </div>
                        
                        <div className="flex justify-between px-2 pb-2 overflow-x-auto scrollbar-hide">
                            {DAYS.map(day => {
                                const active = day.id === selectedDayId;
                                const isRealToday = day.id === new Date().getDay();
                                return (
                                    <button 
                                        key={day.id}
                                        onClick={() => handleDaySelect(day.id)}
                                        className={`flex flex-col items-center justify-center min-w-[50px] py-2 rounded-lg transition-all ${active ? 'bg-white/10 text-white shadow-[0_0_10px_rgba(255,255,255,0.1)]' : 'text-gray-600 hover:text-gray-400'}`}
                                    >
                                        <span className="text-[10px] font-bold tracking-wider">{day.short}</span>
                                        {isRealToday && <div className="w-1 h-1 rounded-full bg-elysian-emerald mt-1"></div>}
                                    </button>
                                )
                            })}
                        </div>
                    </header>

                    <main className="pt-36 px-4 space-y-6 max-w-lg mx-auto safe-area-bottom">
                        
                        {/* DAY HEADER */}
                        <div className="flex items-baseline justify-between">
                            <h1 className="text-2xl font-bold font-sans italic tracking-tighter text-white">
                                {selectedDayName}
                                {!isToday && <span className="text-xs font-mono text-gray-500 not-italic ml-2 opacity-50">PLANLAMA MODU</span>}
                            </h1>
                            <div className="text-xs font-mono text-elysian-emerald">{standardTasks.length} PROTOKOL</div>
                        </div>

                        {/* BIO METRICS */}
                        <BioMetrics xp={xp} tasks={allTasks} routine={weeklyRoutine} />

                        {/* PRAYER TIMES BAR (Visual Only) */}
                        <div className="overflow-x-auto pb-2 scrollbar-hide">
                            <div className="flex gap-2 min-w-max px-1">
                                {prayerTimes.map((p, idx) => {
                                    const isActive = idx === currentPrayerIndex && isToday;
                                    return (
                                        <div key={p.name} className={`flex flex-col items-center justify-center px-3 py-2 rounded border transition-all ${isActive ? 'bg-elysian-emerald/10 border-elysian-emerald text-elysian-emerald' : 'bg-white/5 border-white/5 text-gray-600'}`}>
                                            <span className="text-[9px] font-bold tracking-wider mb-1">{p.name}</span>
                                            <span className="font-mono text-xs">{p.time}</span>
                                        </div>
                                    )
                                })}
                            </div>
                        </div>

                        {/* STANDARD TASKS LIST */}
                        <div className="space-y-3">
                            {standardTasks.length === 0 ? (
                                <div className="flex flex-col items-center justify-center py-10 border border-dashed border-white/10 rounded-xl text-gray-600">
                                    <Activity size={32} className="mb-4 opacity-50" />
                                    <p className="font-mono text-xs">BU DÖNGÜ İÇİN GÖREV YOK</p>
                                    <button onClick={openAddModal} className="mt-4 text-elysian-emerald text-xs font-bold hover:underline">+ PROTOKOL BAŞLAT</button>
                                </div>
                            ) : (
                                standardTasks.map(task => {
                                    const isLocked = task.snoozed >= 2 && !task.completed;
                                    const colorClass = CATEGORY_COLORS[task.category] || CATEGORY_COLORS['DİĞER'];
                                    const criticalClass = task.impact === 'CRITICAL' ? 'border-l-4 border-l-red-500' : '';

                                    return (
                                        <div 
                                            key={task.id}
                                            onClick={() => !isLocked && openZen(task)}
                                            className={`glass-panel rounded-xl p-4 transition-all duration-300 relative overflow-hidden group ${task.completed ? 'opacity-40 grayscale' : 'opacity-100'} ${criticalClass}`}
                                        >
                                            <div className="flex items-start justify-between gap-4">
                                                <div className="flex-1">
                                                    <div className="flex items-center gap-2 mb-1">
                                                        <span className={`text-[9px] font-bold px-1.5 py-0.5 rounded border ${colorClass.split(' ')[0]} border-current bg-opacity-10`}>{task.category}</span>
                                                        <span className="text-xs font-mono text-gray-500 flex items-center gap-1"><Clock size={10} /> {task.time}</span>
                                                        {isLocked && <span className="text-[9px] text-red-500 font-bold flex items-center gap-1"><Lock size={8}/> KİLİTLİ</span>}
                                                    </div>
                                                    <h4 className={`text-base font-bold text-white mb-1 ${task.completed ? 'line-through decoration-gray-600' : ''}`}>{task.title}</h4>
                                                </div>
                                                <div className="flex items-center gap-2" onClick={(e) => e.stopPropagation()}>
                                                    {!task.completed && <button onClick={(e) => openEditModal(task, e)} className="p-2 text-gray-600 hover:text-white transition-colors"><Edit3 size={16} /></button>}
                                                    {!task.completed && !isLocked && <button onClick={(e) => { e.stopPropagation(); snoozeTask(task.id); }} className="p-2 text-yellow-600 hover:text-yellow-400 rounded-lg transition-colors"><Calendar size={18} /></button>}
                                                    <button onClick={(e) => { e.stopPropagation(); toggleTask(task.id); }} className={`p-2 rounded-lg border transition-all active:scale-90 ${task.completed ? 'bg-elysian-emerald border-elysian-emerald text-black shadow-[0_0_10px_#10b981]' : 'bg-white/5 border-white/20 text-gray-400 hover:border-white/50'}`}>
                                                        {task.completed ? <RotateCcw size={18} /> : <CheckCircle2 size={18} />}
                                                    </button>
                                                </div>
                                            </div>
                                            <div className={`absolute bottom-0 left-0 h-[2px] ${task.impact === 'CRITICAL' ? 'bg-red-500 w-full' : task.impact === 'HIGH' ? 'bg-elysian-cyan w-2/3' : 'bg-gray-800 w-1/3'}`}></div>
                                        </div>
                                    );
                                })
                            )}
                        </div>

                         {/* SEPARATED PRAYER SECTION */}
                         {prayerTasks.length > 0 && (
                            <div className="mt-8 pt-6 border-t border-white/10">
                                <div className="flex items-center gap-2 mb-4 text-xs font-mono text-elysian-emerald opacity-80 tracking-widest">
                                    <Activity size={12} />
                                    MANEVİ SENKRONİZASYON
                                </div>
                                <div className="grid grid-cols-5 gap-2">
                                    {prayerTasks.map(task => (
                                        <button 
                                            key={task.id}
                                            onClick={() => toggleTask(task.id)}
                                            className={`
                                                flex flex-col items-center justify-center p-3 rounded-lg border transition-all duration-300 relative overflow-hidden
                                                ${task.completed 
                                                    ? 'bg-elysian-emerald/20 border-elysian-emerald text-elysian-emerald shadow-[0_0_15px_rgba(16,185,129,0.2)]' 
                                                    : 'bg-white/5 border-white/10 text-gray-500 hover:bg-white/10'}
                                            `}
                                        >
                                            <span className="text-[10px] font-bold truncate w-full text-center">
                                                {task.title.replace(' Namazı', '')}
                                            </span>
                                            <div className="mt-2">
                                                {task.completed ? <CheckCircle2 size={18} /> : <div className="w-[18px] h-[18px] rounded-full border-2 border-current opacity-30"></div>}
                                            </div>
                                        </button>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* SUNDAY RESET BUTTON */}
                        {selectedDayId === 0 && (
                            <div className="mt-8 pt-8 border-t border-dashed border-white/10 flex justify-center pb-8">
                                <button 
                                    onClick={finishWeek}
                                    className="px-6 py-4 bg-white/5 border border-white/10 rounded-xl text-xs font-mono tracking-widest text-gray-400 hover:bg-white/10 hover:text-white hover:border-white/30 transition-all flex items-center gap-3 w-full justify-center group"
                                >
                                    <RefreshCw size={16} className="group-hover:rotate-180 transition-transform duration-500" />
                                    HAFTAYI TAMAMLA & SIFIRLA
                                </button>
                            </div>
                        )}

                    </main>

                    {/* FLOATING ADD BUTTON */}
                    <button onClick={openAddModal} className="fixed bottom-6 right-6 w-14 h-14 bg-elysian-emerald text-black rounded-full flex items-center justify-center shadow-[0_0_20px_rgba(16,185,129,0.4)] hover:scale-110 transition-transform z-40 active:bg-white">
                        <Plus size={28} strokeWidth={2.5} />
                    </button>

                    {/* TOAST */}
                    {message && (
                        <div className="fixed bottom-24 left-1/2 transform -translate-x-1/2 bg-elysian-emerald text-black px-4 py-2 rounded font-bold text-xs shadow-[0_0_20px_rgba(16,185,129,0.4)] animate-slide-up z-50 whitespace-nowrap">
                            {message}
                        </div>
                    )}

                    {/* MODALS */}
                    <ZenMode active={zenMode.active} task={zenMode.task} onClose={() => setZenMode({ active: false, task: null })} />
                    <ManualModal isOpen={manualOpen} onClose={() => setManualOpen(false)} />
                    <TaskEditor 
                        isOpen={modalOpen} 
                        onClose={() => setModalOpen(false)} 
                        onSave={handleSaveTask}
                        onDelete={handleDeleteTask}
                        initialData={editingTask}
                    />

                </div>
            );
        };

        const Root = () => {
            return (
                <ErrorBoundary>
                    <App />
                </ErrorBoundary>
            );
        };

        class ErrorBoundary extends React.Component {
            constructor(props) {
                super(props);
                this.state = { hasError: false };
            }
            static getDerivedStateFromError(error) { return { hasError: true }; }
            componentDidCatch(error, errorInfo) { console.error("Critical Failure:", error, errorInfo); }
            handleReset = () => { localStorage.clear(); window.location.reload(); }
            render() {
                if (this.state.hasError) return <ErrorFallback reset={this.handleReset} />;
                return this.props.children;
            }
        }

        const container = document.getElementById('root');
        const root = createRoot(container);
        root.render(<Root />);
    </script>
</body>
</html>
